!function(a){function b(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var c,d=a.ui.mouse.prototype,e=d._mouseInit;d._touchStart=function(a){var d=this;!c&&d._mouseCapture(a.originalEvent.changedTouches[0])&&(c=!0,d._touchMoved=!1,b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))},d._touchMove=function(a){c&&(this._touchMoved=!0,b(a,"mousemove"))},d._touchEnd=function(a){c&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),c=!1)},d._mouseInit=function(){var b=this;b.element.bind("touchstart",a.proxy(b,"_touchStart")).bind("touchmove",a.proxy(b,"_touchMove")).bind("touchend",a.proxy(b,"_touchEnd")),e.call(b)}}}(jQuery);var app=angular.module("WeldSparkApp",[]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!0).hashPrefix("!"),a.when("/:session",{templateUrl:"views/editor.html",controller:"weldEditorController"}).otherwise({redirectTo:"/"})}]).factory("socket",["$rootScope",function(a){var b=window.io&&io.connect()||{on:function(){},emit:function(){}};return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}]).factory("session",["$routeParams",function(a){return{sessionId:a.session}}]);!function(a){Number.prototype.round=function(a){return+(Math.round(this+"e+"+a)+"e-"+a)},String.prototype.toDash=function(){return this.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},String.prototype.toCamel=function(){return this.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})},a.fn.cssProperty=function(a){a=a.toDash();var b=this.attr("style").split(";");for(var c in b){var d=b[c].substring(0,b[c].indexOf(":")).trim();if(d===a)return b[c].substring(b[c].indexOf(":")+1,b[c].length).trim()}return null},a.fn.hasCssProperty=function(a){return this.cssProperty(a)?!0:!1},a.fn.cssPropertyUnit=function(a){var b=this.cssProperty(a),c=parseFloat(b)+"";return b?b.substring(c.length,b.length):null},a.fn.clearCssProperties=function(a){for(var b in a)this.css(a[b],"");return this},a.fn.clearCssPosition=function(){this.clearCssProperties(["position","left","top","right","bottom"])},a.fn.trueWidth=function(){var a=this.width();return a+=parseInt(this.css("padding-left"),10)+parseInt(this.css("padding-right"),10),a+=parseInt(this.css("borderLeftWidth"),10)+parseInt(this.css("borderRightWidth"),10)},a.fn.trueHeight=function(){var a=this.height();return a+=parseInt(this.css("padding-top"),10)+parseInt(this.css("padding-bottom"),10),a+=parseInt(this.css("borderTopWidth"),10)+parseInt(this.css("borderBottomWidth"),10)}}(jQuery),app.factory("keyboardManager",["$window","$timeout",function(a,b){var c={},d={type:"keydown",propagate:!1,inputDisabled:!1,target:a.document,keyCode:!1};return c.keyboardEvent={},c.bind=function(e,f,g){var h,i,j,k;g=angular.extend({},d,g),e=e.toLowerCase(),i=g.target,"string"==typeof g.target&&(i=document.getElementById(g.target)),h=function(c){if(c=c||a.event,g.inputDisabled){var d;if(c.target?d=c.target:c.srcElement&&(d=c.srcElement),3==d.nodeType&&(d=d.parentNode),"INPUT"==d.tagName||"TEXTAREA"==d.tagName)return}c.keyCode?j=c.keyCode:c.which&&(j=c.which);var h=String.fromCharCode(j).toLowerCase();188==j&&(h=","),190==j&&(h=".");for(var i=e.split("+"),l=0,m={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},n={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},o={shift:{wanted:!1,pressed:c.shiftKey?!0:!1},ctrl:{wanted:!1,pressed:c.ctrlKey?!0:!1},alt:{wanted:!1,pressed:c.altKey?!0:!1},meta:{wanted:!1,pressed:c.metaKey?!0:!1}},p=0,q=i.length;k=i[p],q>p;p++){switch(k){case"ctrl":case"control":l++,o.ctrl.wanted=!0;break;case"shift":case"alt":case"meta":l++,o[k].wanted=!0}k.length>1?n[k]==j&&l++:g.keyCode?g.keyCode==j&&l++:h==k?l++:m[h]&&c.shiftKey&&(h=m[h],h==k&&l++)}return l!=i.length||o.ctrl.pressed!=o.ctrl.wanted||o.shift.pressed!=o.shift.wanted||o.alt.pressed!=o.alt.wanted||o.meta.pressed!=o.meta.wanted||(b(function(){f(c)},1),g.propagate)?void 0:(c.cancelBubble=!0,c.returnValue=!1,c.stopPropagation&&(c.stopPropagation(),c.preventDefault()),!1)},c.keyboardEvent[e]={callback:h,target:i,event:g.type},i.addEventListener?i.addEventListener(g.type,h,!1):i.attachEvent?i.attachEvent("on"+g.type,h):i["on"+g.type]=h},c.unbind=function(a){a=a.toLowerCase();var b=c.keyboardEvent[a];if(delete c.keyboardEvent[a],b){var d=b.event,e=b.target,f=b.callback;e.detachEvent?e.detachEvent("on"+d,f):e.removeEventListener?e.removeEventListener(d,f,!1):e["on"+d]=!1}},c}]),app.factory("weldGridManager",["$compile",function(){var a=10,b=null,c=function(a){a.addClass("highlighted"),setTimeout(function(a){a.removeClass("highlighted")},1e3,a)},d=function(a,c){var d=null,e=99999,f="x";"top"===a&&(f="y");var g=b.find(".weld-gridline");for(var h in g)if(1===g[h].nodeType){var i=$(g[h]);if(i.hasClass("weld-gridline")&&i.hasClass(f)){var j=parseInt(i.position()[a]),k=Math.abs(j-c);e>k&&(d=i,e=k)}}return d},e=function(b,d,e,f){if("left"===e||"right"===e||"center"===e){var g="left",h="width",i=d.trueWidth();b.hasCssProperty("left")?"left":"right"}else{var g="top",h="height",i=d.trueHeight();b.hasCssProperty("top")?"top":"bottom"}var j=parseInt(d.position()[g]),k=parseInt(b.position()[g]);if("left"===e||"top"===e)var l=Math.abs(j-k);else if("center"===e||"middle"===e)var l=Math.abs(j+i/2-k);else if("right"===e||"bottom"===e)var l=Math.abs(j+i-k);if(a>l&&(("left"===e||"top"===e)&&(d.css(g,b.cssProperty(g)),c(b)),"right"===e||"bottom"===e)){if("position"===f)d.css(g,k-i+2+"px");else if("%"===d.cssPropertyUnit(g)){var m=2;d.css(h,Math.abs(parseFloat(d.cssProperty(g))-parseFloat(b.cssProperty(g))+m).round(2)+"%")}c(b)}};return{setGridContainerElement:function(a){b=a},addGridLine:function(a,c,d){if(a){var e='<div class="weld-gridline x"></div>',f=$(e);b.append(f),d?f.css("right",a):f.css("left",a)}if(c){var e='<div class="weld-gridline y"></div>',f=$(e);b.append(f),d?f.css("bottom",c):f.css("top",c)}},removeAllGridLines:function(){b.find(".weld-gridline").remove(),b.find(".weld-grid-column").remove()},isGridVisible:function(){return 0===b.find(".weld-gridline").length?!1:!0},createColumnGrid:function(a,c,d){this.addGridLine("0%",null),this.addGridLine("0%",null,!0),this.addGridLine(null,"0%"),this.addGridLine(null,"0%",!0);for(var e,f=100,g=(f-2*d-(a-1)*c)/a,h=0;a>h;h++){e=(d+h*(g+c)).round(2),this.addGridLine(e+"%",null),this.addGridLine(100-e+"%",null);var i='<div class="weld-grid-column"></div>',j=$(i);b.append(j),j.css("left",e+"%").css("width",g+"%")}},alignElementToGrid:function(a,b){var c=["left","top"],f=["right","bottom"];for(var g in c){var h,i=parseInt(a.position()[c[g]]),j="left"===c[g]?a.trueWidth():a.trueHeight();h=d(c[g],i),h&&e(h,a,c[g],b),h=d(c[g],i+j),h&&e(h,a,f[g],b)}}}}]),app.factory("weldComService",["socket","session",function(a,b){return console.log("weldComService ",a),{init:function(c,d,e){console.log("weldComService.init, session:",b),a.emit("wc:register-session",b.sessionId),a.on("ws:create",function(a){console.log("on ws:create",a),c(a)});var f=function(a,b){var c,d;for(c in a)a.hasOwnProperty(c)&&(d=a[c],b(d))};a.on("ws:init-data",function(a){console.log("on ws:init-data",a),f(a,c),f(a,d)}),a.on("ws:update",function(a){d(a)}),a.on("ws:delete",function(a){console.log("on - ws:delete",a),e(a)})}}}]),angular.module("WeldSparkApp").directive("weldCanvas",["$compile","keyboardManager","weldGridManager","weldComService",function(a,b,c,d){return{restrict:"A",link:function(e,f){var g,h,i,j,k=!1,l=function(b){var c=a(b.directive)(e);c.css(b.properties),f.append(c)},m=function(a){if(a&&a.id){var b=f.find("#"+a.id);b.css(a.properties),a.innerHTML&&b.html(a.innerHTML),a.parentId&&b.appendTo("#"+a.parentId)}},n=function(a){f.find("#"+a).remove()};d.init(l,m,n),f.css("cursor: crosshair;"),f.bind("mousedown",function(b){if(1===b.which)if(j=e.getNewElement(),j&&j.directive){k=!0,g=b.offsetX,h=b.offsetY;var c=$(b.target);"content"!==c.attr("id")&&(g+=c.position().left),i=a(j.directive)(e),f.append(i),i.css("position","absolute").css("left",g+"px").css("top",h+"px")}else k=!1,e.$broadcast("DeselectAllElements",null)});var o=function(a){var b,c,d=a.offsetX,e=a.offsetY;return 2===a.eventPhase&&(b=d-g,c=e-h),3===a.eventPhase&&(b=d,c=e),{width:b,height:c}};f.bind("mousemove",function(a){if(k){var b=o(a);i.css("width",b.width+"px").css("height",b.height+"px"),e.$emit("AlignElement",i,"position")}});var p=function(a){var b=f.find("#"+a.id);e.updatePropertiesFromElement(b)};f.bind("mouseup",function(a){if(k=!1,j&&j.directive){var b=o(a),c={id:j.id,directive:j.directive,properties:{left:g+"px",top:h+"px",width:b.width+"px",height:b.height+"px"}};e.createElement(c),p(c),j=null}}),f.droppable({greedy:!0,accept:".weld-element",hoverClass:"ui-droppable-hover",activeClass:"ui-droppable-target",drop:function(a,b){var c=b.draggable.attr("id"),d=$(this).attr("id");console.log("Dropped "+c+" on "+d),b.draggable.parent().attr("id")!==$(this).attr("id")&&(b.draggable.appendTo(this),b.draggable.clearCssPosition(),e.$emit("ElementWasUpdated",b.draggable))}}),c.setGridContainerElement(f),e.toggleGrid=function(){c.isGridVisible()?c.removeAllGridLines():(console.log("Creating grid"),c.createColumnGrid(12,1,.5))},e.deleteSelectedElement=function(){console.log("DeleteElement");var a=e.selectedElement.attr("id");e.selectedElement.remove(),e.selectedElement=null,e.deleteElement(a)},e.duplicateSelectedElement=function(){console.log("Duplicate")},e.$on("AlignElement",function(a,b,d){c.alignElementToGrid(b,d)}),e.$watch("appProperties.showGrid",function(a){a?(console.log("Creating grid"),c.createColumnGrid(12,1,.5)):c.removeAllGridLines()});var q=function(a){switch(a){case"Select":f.css("cursor","pointer");break;case"Text":f.css("cursor","text");break;default:f.css("cursor","crosshair")}};e.$watch("tools.selected",q),b.bind("backspace",e.deleteSelectedElement,{inputDisabled:!0}),b.bind("delete",e.deleteSelectedElement,{inputDisabled:!0}),b.bind("ctrl+d",e.duplicateSelectedElement,{inputDisabled:!0}),b.bind("meta+d",e.duplicateSelectedElement,{inputDisabled:!0}),b.bind("g",function(){e.toggleGrid()},{inputDisabled:!0}),b.bind("shift+g",c.removeAllGridLines),b.bind("h",function(){console.log("Creating test grid"),c.addGridLine("150px",null),c.addGridLine("40%",null)},{inputDisabled:!0}),b.bind("c",function(){console.log("Creating center grid"),c.removeAllGridLines(),c.addGridLine("50%",null),c.addGridLine(null,"50%")},{inputDisabled:!0})}}}]),angular.module("WeldSparkApp").directive("weldElement",["$compile","$rootScope",function(a,b){return{restrict:"C",scope:{},link:function(a,c){var d=function(){b.$$phase?setTimeout(function(){a.$apply()}):a.$apply()};a.toggleSelectElement=function(){a.isSelected=!a.isSelected,a.isSelected?a.selectElement():a.deselectElement()},a.selectElement=function(){a.$emit("ElementWasSelected",c),c.hasClass("selected")||(c.addClass("selected"),c.draggable({start:function(){c.tempZ=c.css("z-index"),c.css("z-index",100),c.hasCssProperty("right")&&(c.css("width",c.width()+"px"),c.clearCssProperties(["right"]))},drag:function(){a.$emit("AlignElement",c,"position"),a.$emit("ElementWasUpdated",c)},stop:function(){c.css("z-index",c.tempZ),a.$emit("AlignElement",c,"position"),a.$emit("ElementWasUpdated",c)}}),c.append('<div class="ui-resizable-handle ui-resizable-nw" id="nwgrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-ne" id="negrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-sw" id="swgrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-se" id="segrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-n"  id="ngrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-s"  id="sgrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-e"  id="egrip"></div>'),c.append('<div class="ui-resizable-handle ui-resizable-w"  id="wgrip"></div>'),c.resizable({handles:{nw:"#nwgrip",ne:"#negrip",sw:"#swgrip",se:"#segrip",n:"#ngrip",e:"#egrip",s:"#sgrip",w:"#wgrip"},resize:function(){a.$emit("AlignElement",c,"size"),a.$emit("ElementWasUpdated",c)}}))},a.deselectElement=function(){c.hasClass("selected")&&(a.isSelected=!1,c.removeClass("selected"),c.draggable("destroy"),c.resizable("destroy"),c.find(".control-handle").remove()),a.isEditing&&a.endTextEditing()},a.$on("DeselectAllElements",function(b,d){c!==d&&a.deselectElement()}),a.innerHTML="Text",a.isEditing=!1,a.beginTextEditing=function(){a.isEditing=!0,d(),c.find(".weld-inline-editor").focus()},a.endTextEditing=function(b){console.log("endTextEditing",a.isEditing,b),b&&b.preventDefault&&b.preventDefault(),a.isEditing=!1,d(),a.$emit("ElementWasUpdated",c)},c.bind("mousedown",function(b){1===b.which&&(b.stopPropagation(),a.selectElement())}),c.bind("dblclick",function(){a.beginTextEditing()}),a.selectElement()}}}]),angular.module("WeldSparkApp").directive("weldListMenu",function(){var a='<div class="ui_panel"><h1>&gt; Header</h1><div ng-repeat="category in menuItems.categories"><h2>{{category.label}}</h2><a ng-repeat="item in category.items" ng-click="selectMenuItem(item.label)" ng-class="{selected: item.label==menuItems.selected}" class="tool_button" id="tool_{{item.id}}"><img alt="{{item.label}}" src="../images/{{item.icon}}.png"/><span class="tool_button_label">{{item.label}}</span></a></div></div>';return{restrict:"A",replace:!0,template:a,scope:{headerText:"=weldListMenu",menuItems:"=",menuSelected:"=",showLogo:"="},controller:["$scope",function(a){a.selectMenuItem=function(b){a.menuItems.selected=b}}],link:function(a,b){a.showLogo&&b.prepend('<div class="weld_logo"></div>'),a.$watch("menuSelected",function(){})}}}),app.directive("weldPropertiesPanel",function(){return{template:'<div id="properties" class="ui_panel"><p>Weld Sketch v0.2.0</p><label for="grid-switch">Grid:</label><weld-on-off-switch id="grid-switch" ng-model="appProperties.showGrid"></weld-on-off-switch><fieldset><label for="position-selector">Flow or Set Position:</label><select id="position-selector" ng-model="elementProperties.position" ng-options="p.value as p.name for p in positions"></select><label for="left">X:</label><input id="left" placeholder="X" ng-model="elementProperties.left"></input><label for="top">Y:</label><input id="top" placeholder="Y" ng-model="elementProperties.top"></input><label for="width">W:</label><input id="width" placeholder="Width" ng-model="elementProperties.width"></input><label for="height">H:</label><input id="height" placeholder="Height" ng-model="elementProperties.height"></input></fieldset><fieldset><label for="background-color-picker">Background:</label><color-picker id="background-color-picker" color-variable="elementProperties.backgroundColor"></color-picker><label for="border-color-picker">Border:</label><select id="border-width-selector" ng-model="elementProperties.borderWidth" ng-options="w.value as w.name for w in borderWidths"></select><color-picker id="border-color-picker" color-variable="elementProperties.borderColor"></color-picker><label for="border-radius-selector">Border radius:</label><select id="border-radius-selector" ng-model="elementProperties.borderRadius" ng-options="r.value as r.name for r in borderRadiuses"></select></fieldset></div>',restrict:"A",scope:{elementProperties:"=",appProperties:"="},link:function(a){a.origins=[{name:"Top-Left",value:"top-left"},{name:"Center-Middle",value:"center-middle"},{name:"Bottom-Right",value:"bottom-right"}],a.positions=[{name:"Free-flow",value:"relative"},{name:"Position",value:"absolute"}],a.borderWidths=[{name:"None",value:"0"},{name:"1px",value:"1px"},{name:"2px",value:"2px"},{name:"5px",value:"5px"},{name:"10px",value:"10px"}],a.borderRadiuses=[{name:"None",value:"0"},{name:"2px",value:"2px"},{name:"4px",value:"4px"},{name:"8px",value:"8px"},{name:"16px",value:"16px"},{name:"20%",value:"20%"},{name:"50%",value:"50%"}]}}}),angular.module("WeldSparkApp").directive("colorPicker",function(){return{restrict:"E",replace:!0,scope:{colorVariable:"="},template:'<div class="color-picker"><div ng-repeat="colorItem in colorList" class="color-box" ng-class="{selected: colorItem.isSelected}" style="background-color: {{colorItem.colorValue}}" ng-click="clickColor(colorItem)"></div></div>',compile:function(){var a=["","#000000","#FFFFFF","#CCCCCC","#5484ED","#A4BDFC","#46D6DB","#7AE7BF","#51B749","#FBD75B","#FFB878","#FF887C","#DC2127","#DBADFF"];return{post:function(b){b.colorList=[],angular.forEach(a,function(a){b.colorList.push({colorValue:a,isSelected:!1})})}}},controller:["$scope","$element","$timeout",function(a){function b(a){var b=parseInt(a).toString(16).toLowerCase();return 1==b.length?"0"+b:b}function c(a,c,d){return"#"+b(a)+b(c)+b(d)}function d(a){if(!a)return void 0;var b=a.substring(4,a.length-1),d=b.split(", ");return c(d[0],d[1],d[2])}function e(a,b){return b?a.toLowerCase()===b.toLowerCase()||a.toLowerCase()===d(b)?!0:!1:!1}a.clickColor=function(b){for(var c=0;c<a.colorList.length;c++)a.colorList[c].isSelected=!1,a.colorList[c]===b&&(a.colorVariable=b.colorValue,a.colorList[c].isSelected=!0)},a.$watch("colorVariable",function(b){for(var c=0;c<a.colorList.length;c++)a.colorList[c].isSelected=!1,e(a.colorList[c].colorValue,b)&&a.clickColor(a.colorList[c])})}]}}),app.directive("weldOnOffSwitch",function(){return{template:'<div class="onoffswitch"><input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch"><label class="onoffswitch-label" for="myonoffswitch"><div class="onoffswitch-inner"></div><div class="onoffswitch-switch"></div></label></div>',restrict:"E",scope:{ngModel:"="},link:function(a,b){b.bind("click",function(){a.ngModel="38px"===b.find(".onoffswitch-switch").css("right")?!0:!1,a.$apply()})}}}),app.controller("weldEditorController",["$scope","session","socket","$rootScope",function(a,b,c,d){a.lastElementId=0,a.selectedElement=null,c.on("ws:assign-socket-id",function(a){console.log("on ws:assign-socket-id",a),b.socketId=a}),a.createElement=function(b){c.emit("wc:create",b),a.tools.selected="Select",a.$apply("menuSelected")},a.deleteElement=function(a){c.emit("wc:delete",a)},a.elementPropertyChanged=function(b){if(b){var d={id:b.attr("id"),properties:a.elementProperties,innerHTML:""!==b.html()&&"<"!==b.html()[0]?b.html():null,parentId:b.parent().attr("id")};c.emit("wc:update",d)}},a.getNewElement=function(){a.lastElementId++;var c=null,d=null,e=function(c){return c+b.socketId+"-"+a.lastElementId};switch(a.tools.selected){case"Rectangle":d=e("rectangle-"),c='<div class="weld-element weld-element-container weld-rectangle" id="'+d+'" style="background: #CCC;"></div>';break;case"Text":d=e("text-"),c='<span class="weld-element" style="position: absolute;" id="'+d+'"><span class="weld-text" ng-hide="isEditing">{{innerHTML}}</span><form ng-show="isEditing" ng-submit="endTextEditing($event)"><input type="text" class="weld-inline-editor" ng-model="innerHTML"></input></form></span>';break;case"Image":d=e("img-"),c='<img class="weld-element" src="http://placekitten.com/g/300/300" style="position: absolute;" id="'+d+'"/>';break;case"Button":d=e("button-"),c='<button class="weld-element" type="button" style="position: absolute;" id="'+d+'">Button</button>';break;case"Input":d=e("input-"),c='<input class="weld-element" type="text" style="position: absolute;" id="'+d+'"></input>';break;default:console.log("Can't draw - no valid tool selected.")}return{id:d,directive:c}},a.tools={categories:[{label:"Basic",items:[{id:"select",label:"Select",icon:"toolicon_select"},{id:"rectangle",label:"Rectangle",icon:"toolicon_rectangle"},{id:"text",label:"Text",icon:"toolicon_text"}]},{label:"Experimental",items:[{id:"image",label:"Image",icon:"toolicon_image"},{id:"button",label:"Button",icon:"toolicon_button"},{id:"input",label:"Input",icon:"toolicon_input"}]}],selected:"Select"},a.elementProperties={},a.appProperties={showGrid:!1},a.updatePropertiesFromElement=function(b){a.elementProperties={};var c=["position","left","top","right","bottom","width","height","margin","padding","backgroundColor","borderColor","borderWidth","borderRadius"];for(var e in c)c.hasOwnProperty(e)&&(a.elementProperties[c[e]]=b.cssProperty(c[e]));d.$$phase?setTimeout(function(){a.$apply()}):a.$apply()},a.$on("ElementWasSelected",function(b,c){a.$broadcast("DeselectAllElements",c),a.selectedElement=c,a.updatePropertiesFromElement(c)}),a.$on("ElementWasUpdated",function(b,c){a.updatePropertiesFromElement(c),a.elementPropertyChanged(c)});var e=function(a,b){return(a||b)&&a!==b},f=function(b,c){e(b,c)&&a.selectedElement&&(a.selectedElement.css(a.elementProperties),a.elementPropertyChanged(a.selectedElement))},g=function(b,c){a.selectedElement&&(f(b,c),"relative"===b&&a.selectedElement.clearCssProperties(["left","top"]))};a.$watch("elementProperties.position",g),a.$watch("elementProperties.left",f),a.$watch("elementProperties.top",f),a.$watch("elementProperties.marginLeft",f),a.$watch("elementProperties.marginTop",f),a.$watch("elementProperties.width",f),a.$watch("elementProperties.height",f),a.$watch("elementProperties.backgroundColor",f),a.$watch("elementProperties.borderColor",f),a.$watch("elementProperties.borderWidth",f),a.$watch("elementProperties.borderRadius",f)}]);